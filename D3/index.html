<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="d3.js"></script>
		<script type="text/javascript" src="d3-scale.js"></script>
		<link rel="stylesheet" type="text/css" src="style.css"></link>
    </head>
    <body>
        <script type="text/javascript">
			var w = 700;
			var h = 500;
			var padding = 30;
			var	circleRadius = 4;
			
			//From https://bl.ocks.org/mbostock/7621155
			var superscript = "⁰¹²³⁴⁵⁶⁷⁸⁹",
    			formatPower = function(d) { return (d + "").split("").map(function(c) { return superscript[c]; }).join(""); };
			
			d3.json("urban_bb_sub.json").then(function(data) {
				if (data == null) {
				console.log("Error loading data");
				} else {
					console.log("Data loaded");
					console.log(data[0]);
				}
				var xScale = d3.scaleLog()
					.base(10)
               		.domain([0.2, d3.max(data, function(d) { return d["dload_speed"]; })])
               		.range([w - (padding + 2 * circleRadius), padding +(2 * circleRadius) + 1])
					.nice();
				var yScale = d3.scaleLinear()
               		.domain([0, d3.max(data, function(d) { return d["total_charge"]; })])
               		.range([padding + (2 * circleRadius) + 1, h - (padding + 2 * circleRadius + 1)]);
				var xAxis = d3.axisTop()
					.scale(xScale)
					.tickValues([1, 10, 100, 1000, 10000])
					.tickFormat(function(d) { return Math.round(d); });
				var yAxis = d3.axisRight().
					scale(yScale);
				makeScatter(data, xScale, yScale, xAxis, yAxis);
			});
			
			var svg = d3.select("body").append("svg")              
    			.attr("width", w)
				.attr("height", h);
			
			var makeScatter = function(dataset, xScale, yScale, xAxis, yAxis) {
				svg.selectAll("circle")
					.data(dataset)
					.enter()
					.append("circle")
					.attr("cx", function(d){return w / 2})
					.attr("cy", function(d){return h / 2})
					.attr("r", function(d){return 0})
					.attr("fill", "black")
					.transition()
					.duration(2000)
					.ease(d3.easeCircleIn)
					.attr("cx", function(d){ return xScale(d["dload_speed"]); })
					.attr("cy", function(d){ return yScale(d["total_charge"]); })
					.attr("r", circleRadius)
					.attr("fill", function(d){
						if (d["tech"] == "FTTH") {return "blue"};
						if (d["tech"] == "Cable") {return "red"};
						if (d["tech"] == "Wireless") {return "orange"};
						if (d["tech"] == "DSL") {return "green"};
						return "grey";
					});
				
				svg.append("g")
					.attr("class", "axis")
					.attr("transform", "translate(0," + (0 + padding)+ ")")
					.call(xAxis);
				
				svg.append("g")
					.attr("class", "axis")
					.attr("transform", "translate(" + (w - padding)+ ", 0)")
					.call(yAxis);
			}
        </script>
    </body>
</html>